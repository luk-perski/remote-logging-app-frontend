@(r: play.mvc.Http.Request, u: utils.Utils, page_settings: utils.app.page.PageSettings, report_execution: models.db.app.report.ReportExecution)

@base.bo_body(r, u, u.l.l(r, "reports.title.report_execution_access_logs"), page_settings) { } {

	<div class="container-fluid">

	  	<h1>@u.l.l(r, "reports.title.report_execution_access_logs")</h1>

	  	@if(report_execution == null){
	  		<p class="alert alert-danger mt-3 mb-3">@u.l.l(r, "general.text.record_not_found")</p>
	  	}else{
  			<table class="small table table-responsive">
  				<thead class="thead-light">
  					<tr>
  						<th class="text-center">@u.l.l(r, "reports.label.execution_date_begin")</th>
  						<th class="text-center">@u.l.l(r, "reports.label.execution_date_end")</th>
  						<th class="text-center">@u.l.l(r, "reports.label.execution_date_duration")</th>
  					</tr>
  				</thead>
  				<tbody>
					<tr>
						<td class="text-center">
							<span title="@u.date_utils.getStringFromDateTime(report_execution.getExecutionDateBegin(), null)">@u.date_utils.getRelativeDate(report_execution.getExecutionDateBegin()) @u.l.l(r, "general.label.ago")</span>
						</td>
						<td class="text-center">
							<span title="@u.date_utils.getStringFromDateTime(report_execution.getExecutionDateEnd(), null)">@u.date_utils.getRelativeDate(report_execution.getExecutionDateEnd()) @u.l.l(r, "general.label.ago")</span>
						</td>
						<td class="text-center">
							@u.date_utils.timeDifferenceInMinutes(report_execution.getExecutionDateBegin(), report_execution.getExecutionDateEnd()) min.
						</td>
					</tr>
  				</tbody>
  			</table>

  			<h3>@u.l.l(r, "reports.title.report_execution_access_logs")</h3>

  			@defining(report_execution.getOutputs()){ outputs =>
  				@if(outputs != null && !outputs.isEmpty()){
  					@for(output <- outputs){

  						<p class="mt-4 mb-3">
  							<b><a href="@controllers.routes.FileController.renderResourceAssociatedFile(output.getID())" target="_blank">
  								<i class="fa fa-file"></i> @output.getFileName()
  							</a></b>
  						</p>

  						@defining(output.getAccessRecords()){ access_records =>
  							@if(access_records != null && !access_records.isEmpty()){
  								<ul>
  									@for(access_record <- access_records){
  										<li>
  											<span title="@u.date_utils.getStringFromDateTime(access_record.getAccessedDate(), null)">@u.date_utils.getRelativeDate(access_record.getAccessedDate()) @u.l.l(r, "general.label.ago")</span>
  											-
  											<a href="mailto:@access_record.getUser().getEmail()">@access_record.getUser().getDisplayName()</a>
  										</li>
  									}
  								</ul>
  							}else{
  								<p class="alert alert-warning">@u.l.l(r, "reports.text.no_access_records_yet")</p>
  							}
  						}
  					}
  				}else{ -- }
  			}

  			<div class="mt-3 mb-3">
  				<a href="@controllers.bo.routes.BackofficeReportsController.renderReportRequest(report_execution.getReportRequest().getID())" class="btn btn-outline-primary">
  					<i class="fa fa-chevron-circle-left"></i> @u.l.l(r, "general.label.back")
  				</a>
  			</div>
	  	}
	</div>
} { }
