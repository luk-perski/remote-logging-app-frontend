@(r: play.mvc.Http.Request, u: utils.Utils, page_settings: utils.app.page.PageSettings, report_requests: List[models.db.app.report.ReportRequest])

@base.bo_body(r, u, u.l.l(r, "reports.title.report_requests"), page_settings) { } {

	<div class="container-fluid">

	  	<h1>
		  	<div class="float-right small">
	  			<a href="@controllers.bo.routes.BackofficeReportsController.renderAddReportRequestForm()" class="btn btn-primary"><i class="fa fa-plus-square"></i> @u.l.l(r, "reports.label.request_report")</a>
		  	</div>

	  		@u.l.l(r, "reports.title.report_requests")
  		</h1>

	  	@if(report_requests == null || report_requests.isEmpty()){
	  		<p class="alert alert-warning mt-3 mb-3">@u.l.l(r, "reports.text.no_report_requests_yet")</p>
	  	}else{
	  		<table class="table table-responsive table-bordered mt-3 mb-3">
	  			<thead class="thead-dark">
	  				<tr>
	  					<th>@u.l.l(r, "reports.label.report_type")</th>
	  					<th>@u.l.l(r, "reports.label.request_user")</th>
	  					<th class="text-center">@u.l.l(r, "reports.label.request_date")</th>
	  					<th class="text-center">@u.l.l(r, "reports.label.is_recurrent") (@u.l.l(r, "reports.label.periodicity"))</th>
	  					<th class="text-center">@u.l.l(r, "reports.label.executions")</th>
	  					<th class="text-center">@u.l.l(r, "reports.label.is_active")</th>
	  					<th class="text-center">@u.l.l(r, "reports.label.options")</th>
	  				</tr>
	  			</thead>
	  			<tbody>
	  				@for(report_request <- report_requests){
	  					<tr class="@if(report_request.isActive()){ @if(report_request.isExecuting()){ table-warning }else{ @if(report_request.hasExecutions()){ table-success }else{ table-primary } } }else{ table-danger }">
	  						<td>
	  							@if(report_request.getReportType() != null){
	  								@u.l.lto(r, report_request.getReportType(), "getLabel")
	  							}
	  						</td>
	  						<td>
	  							@if(report_request.getRequestUser() != null){
	  								<a href="mailto:@report_request.getRequestUser().getEmail()">@report_request.getRequestUser().getDisplayName()</a>
	  							}
	  						</td>
	  						<td class="text-center">
	  							<span title="@u.date_utils.getStringFromDateTime(report_request.getRequestDate(), null)">@u.date_utils.getRelativeDate(report_request.getRequestDate()) @u.l.l(r, "general.label.ago")</span>
	  						</td>
	  						<td class="text-center">
	  							@if(report_request.isRecurrent()){
	  								<i class="fa fa-retweet" title="@u.l.l(r, "general.label.yes")"></i>
	  								(@report_request.getPeriodicity() min.)
	  							}else{
	  								<span title="@u.l.l(r, "general.label.no")">
	  									<i class="fa fa-times text-danger" title="@u.l.l(r, "general.label.no")"></i>
	  								</span>
	  							}
	  						</td>
	  						<td class="text-center">
	  							@if(report_request.isExecuting()){
	  								<i class="fa fa-cog fa-spin fa-fw"></i>
	  							}else{
	  								@if(report_request.hasExecutions()){
	  									@*<i class="fa fa-check text-success" title="@u.l.l(r, "general.label.yes")"></i>*@
	  									@report_request.getExecutions().size()
	  								}else{
	  									<i class="fa fa-times text-danger" title="@u.l.l(r, "general.label.no")"></i>
	  								}
	  							}
	  						</td>
	  						<td class="text-center">
	  							@if(!report_request.isExecuting() && (!report_request.hasExecutions() || report_request.isRecurrent())){
		  							<form action="@controllers.bo.routes.BackofficeReportsController.toggleReportRequestState(report_request.getID())" method="post" class="force-inline">
		  								@helper.CSRF.formField(r.asScala)
		  								@if(report_request.isActive()){
		  									<button type="submit" class="btn btn-link text-success p-0"><i class="fa fa-toggle-on"></i></button>
		  								}else{
		  									<button type="submit" class="btn btn-link text-danger p-0"><i class="fa fa-toggle-off"></i></button>
		  								}
		  								</button>
		  							</form>
	  							}else{
	  								@if(report_request.isActive()){
	  									<i class="fa fa-check text-success" title="@u.l.l(r, "general.label.yes")"></i>
	  								}else{
	  									<i class="fa fa-times text-danger" title="@u.l.l(r, "general.label.no")"></i>
	  								}
	  							}
	  						</td>
	  						<td class="text-center">
	  							<a href="@controllers.bo.routes.BackofficeReportsController.renderReportRequest(report_request.getID())" class="ml-2"><i class="fa fa-search-plus"></i></a>
	  						</td>
	  					</tr>
	  				}
	  			</tbody>
	  		</table>
	  	}
	</div>
} { }
