@(r: play.mvc.Http.Request, u: utils.Utils)

@base.body(r, u, "Form Generator Example", null) { } {

	<div class="container-fluid">
		<h1>Form Generator Example</h1>

	  	<div id="app" v-cloak>
	  		<component :is="form_data.component" :element="form_data" :lang="language" :key="form_data.id"></component>

	  		<div class="loading-block">
	  			<i class="fa fa-circle-o-notch fa-spin fa-fw"></i>
				<span class="sr-only">Loading...</span>
	  		</div>
	  	</div>
	</div>

} {
    @base.vue_dependency()

    <script src="@controllers.routes.Assets.versioned("javascripts/vue/components/form_components.js")" type="text/javascript"></script>

	<script type="text/javascript">
		var app = new Vue({
		  	el: '#app',
		  	data: {
		  		form_data: {},
		    	language: "@u.l.getLanguage(r)"
		  	},
		  	updated: loadValidationHandlers
		});

		function loadForm(form_id){
			jsRoutes.controllers.ajax.AJAXTestController.getFormData(form_id).ajax().done(function(data){
				if(data && data.data && data.data.form_data){
					app.form_data = data.data.form_data;
					app.language = data.language;
				}else {
					showDialog('danger', messages('error.label.unexpected_error'), messages("general.text.operation_error"));
				}
			}).fail(function(jqxhr){
				try{
					console.log(jqxhr.responseText);
					var data = JSON.parse(jqxhr.responseText);
					if(data && data.error_message){
						showDialog('danger', messages('error.label.unexpected_error'), messages("general.text.operation_error"));
					}
				}catch(err) {
					console.error(err);
					showDialog('danger', messages('error.label.unexpected_error'), messages("general.text.operation_error"));
				}
			});
		}

		$(document).ready(function(){
			loadForm(1);
		});

		function showDialog(_theme, _title, _message){
			bootbox.setLocale(this.lang).alert({
				message: _message,
				title: _title,
				className: _theme
			});
		}

	</script>
}
